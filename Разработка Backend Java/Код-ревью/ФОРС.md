
``` java
public class UserBalanceService {

    @Autowired
    UserBalanceRepository repository;
    @Autowired
    UserAccountStatusService accountStatusService;
    @Autowired
    BalanceOperationsRepository balanceOperationsRepository;
    @Autowired
    CurrencyConvertRestClient currencyConvertRestClient;
    @Autowired
    NotificationRestClient notificationRestClient;
    @Autowired
    OperationLogRepository operationLogRepository;
    @Value("app.settings.currency-default")
    String defaultCurrency;

    @Transactional
    public void changeBalance(UUID userId, Double balance, String currency) {
        if (userId == null || balance == null) {
            throw new IllegalArgumentException("Один или несколько аргументов равны null");
        }
        if (currency == null) {
            currency = defaultCurrency;
        }
        UserBalance userBalance = repository.getUserBalanceById(userId);
        if (accountStatusService.isAccountSuspended(userBalance) {
            throw new IllegalStateException("Невозможно изменить баланс пользователя, так счёт пользователя заморожен");
        }
        Double convertedAmount = currencyConvertRestClient.convert(balance, currency, userBalance.getCurrency());
        userBalance.setBalance(userBalance.getAmount() + convertedAmount);
        try
        {
            saveToLog(userId, balance, currency, null, true);
            repository.save(userBalance);
        } catch (BalanceChangeException e)
        {
            saveToLog(userId, balance, currency, e.getMessage(), false);
            notificationRestClient.notifyErrorBalanceChange(userId, balance, currency);
            throw e;
        }
        notificationRestClient.notifyBalanceChangeOk(userId, balance, currency);
    }

    @Transactional
    public void saveToLog(UUID userId, Double balance, String currency, String ErrorMessage, Boolean ok) {
        if(ok) operationLogRepository.addBalanceChangeOk(userId, balance, currency);
        else {
            operationLogRepository.addBalanceChangeError(userId, balance, ErrorMessage, currency);
        }
    }
}

@Component
public class UserAccountStatusService {
    public boolean isAccountActive(UserBalance balance) {
        return balance.getAccountStatus() == UserAccountStatus.ACTIVE;
    }

    public boolean isAccountSuspended(UserBalance balance) {
        return balance.getAccountStatus() == UserAccountStatus.SUSPENDED;
    }
    
    public boolean isAccountClosed(UserBalance balance) {
        return balance.getAccountStatus() == UserAccountStatus.CLOSED;
    }
}


public class UserBalance {
    /** Какая-то реализация ***/
}

public enum UserAccountStatus {
    // Счёт пользователя активен
    ACTIVE, 
    
    // Счёт пользователя заморожен
    SUSPENDED, 
    
    // Счёт пользователя закрыт
    CLOSED;
}

public interface BalanceOperationsRepository {
    /** Какая-то реализация ***/
}

public interface UserBalanceRepository {
    /** Какая-то реализация ***/
}

public interface CurrencyConvertRestClient {
    /** Какая-то реализация ***/
}

public interface NotificationRestClient {
    /** Какая-то реализация ***/
}

interface OperationLogRepository {
    /** Какая-то реализация ***/
}

```