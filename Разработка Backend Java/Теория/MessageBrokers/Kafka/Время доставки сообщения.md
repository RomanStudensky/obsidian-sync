
![[Pasted image 20250625123500.png]]

Разделяют 2 временных интервала. Время от отправки send до асинхронного ответа. Время после получения ответа.

**max.block.ms** – контролирует как долго консюмер может блочиться при вызове send. По истечение выдается исключение времени ожидания

**delivery.timeout.ms** – эта конфигурация ограничивает время, которое проходит с момента, когда запись готова к отправке (send возвращается успешно, и запись помещается в пакет), до момента, пока брокер не ответит или клиент не откажется, включая время на ретраи. Если производитель превысит delivery.timeout.ms при повторной попытке, обратный вызов будет выполнен с исключением

**request.timeout.ms** – определяет максимальное время ожидания ответа от сервера. Будет выброшено исключение, либо будет ретрай.

**retries** – кол-во ретраев

**retry.backoff.ms** – определяет сколько ждать между ретраями из-за временной недоступности сервера.

Нужно проверить сколько времени потребуется для восстановления брокера после сбоя. Устанавливаем **delivery.timeout.ms** таким, чтобы оно было больше времени восстановления брокера, чтобы продюсер не сдался слишком рано

Не все ошибки будут ретраиться, т.к. некоторые нельзя считать временными и повтор не может привести к положительному результату (например «сообщение слишком большое»).

**linger.ms** – длительность времени ожидания дополнительных сообщений перед отправкой текущего пакета. Сообщения отправляются, когда появляется отдельный поток отправителя, даже если в пакете всего одно сообщение. Значение выше 0 даёт команду производителю ждать перед отправкой. **linger.ms** дельта между _готовностью отправить_ и _отправкой_. Таким образом можно увеличить задержку и пропускную способность

**max.block.ms** – определяет как долго отправка может лочиться 

**buffer.memory** – задаёт объем памяти, используемой продюсером для буферизации сообщений, ожидающих отправки брокером.  Если приложение отправляет сообщения быстрее, чем они прилетают на сервер, то копится буфер ожидания ответов и засоряет память

**compression.type** – по умолчанию сообщения отправляются несжатыми. Возможные варианты сжатия: snappy, gzip, lz4 и zstd. Snappy – оптимальный вариант. Gzip – долгий, но самый эффективный

**batch.size** – максимальный объем памяти в байтах для каждого пакета. При увеличении значения объем пакета не увеличится наверняка, т.к. продюсер может отправить пакет даже с одним сообщением. Если зададим слишком большое значение, то это приведет к использованию большего кол-ва памяти для пакетов. Если слишком малое, то к использованию слишком большого объема памяти для пакетов за счет их количества

**max.in.flight.requests.per.connection** – кол-во пакетов сообщений, которые производитель может отправить серверу, не получая ответа.

**max.request.size** – задает максимальный размер отправляемых производителем сообщений в одном запросе (по умолчанию 1 Мбайт). Означает, что мы можем отправить 1 сообщение размером 1 Мбайт или 1024 размером 1 Кбайт.

**message.max.bytes** – задает максимальный размер принимаемого сообщения для брокера. *Используется при конфигурации брокера.

**receive.buffer.bytes** и **send.buffer.bytes** – задает размеры TCP-буферов отправки и получения, используемых сокетами при записи и чтении данных. Рекомендуется регулировать при взаимодействии с брокерами из других ЦОД, т.к. увеличиваются транспортные расходы.