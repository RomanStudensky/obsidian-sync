Для фиксации значений есть методы фиксации _commitSync()_ и _commitAsync()_. По умолчанию фиксируют последнюю прочитанную запись, 

 В методы фиксации также можно передать мапу разделов и смещений:

  ``` java
  
  private Map<TopicPartition, OffsetAndMetadata> currentOffsets = new HashMap<>();
int count = 0;
Duration timeout = Duration.ofMillis(100);

while (true) {
	ConsumerRecords<String, String> records = consumer.poll(timeout);
	for (ConsumerRecord<String, String> record : records) {
		System.out.printf("topic = %s, partition = %s, offset = %d,
			customer = %s, country = %s\n",
			record.topic(), record.partition(), record.offset(),
			record.key(), record.value()
);
		currentOffsets.put(
			new TopicPartition(record.topic(), record.partition()),
			new OffsetAndMetadata(record.offset()+1, "no metadata")
); 
		if (count % 1000 == 0)
			consumer.commitAsync(currentOffsets, null);
		count++;
	}
}  
```
  

1. Потребители отправляют сообщение в Kafka, которое обновляет специальный топик *consumer___offsets_*, содержащий смещение для каждого из разделов.
2. В случае присоединения нового потребителя к группе это инициирует перебалансировку.
3. После нее каждому из потребителей может быть назначен набор разделов отличный от обрабатываемого им ранее. Чтобы знать откуда продолжить работать потребитель должен прочитать последнее зафиксированное смещение для каждого из разделов и продолжить оттуда.