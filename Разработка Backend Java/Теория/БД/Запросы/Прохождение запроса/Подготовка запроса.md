## Протокол простых запросов

### Лексический разбор
Разбор на лексемы(ключевые слова, литералы..)

### Синтаксический разбор
Проверят соответствие грамматике языка

``` sql
SELECT schemaname, tablename
FROM pg_tables
WHERE tableowner = 'postgres'
ORDER BY tablename;
```

Для запроса будет построено следующее дерево запроса:

![[Pasted image 20250623082649.png]]
*RTE* *(Range Table Entry)* — таблицы, подзапросы, результаты соединений — иными словами, наборы строк, над которыми работают операторы SQL.

### Семантический разбор
Определяются ссылки на объекты БД в запросе.

Получает дерево разбора и дополняет его ссылками на объекты БД.

Полное дерево можно получить в журнале сообщений сервера, установив параметр _debug_print_parse_, хотя практического смысла в этом немного.


### Трансформация
Переписывание запроса

Заменяет имя представления в дереве разбора на поддерево, соответствующее запросу этого представления.

Например, *pg_tables* - представление, и после примет вид:

![[Pasted image 20250623085238.png]]

```sql
SELECT schemaname, tablename
FROM (
	SELECT n.nspname AS schemaname,
			c.relname AS tablename,      
			pg_get_userbyid(c.relowner) AS tableowner
	FROM pg_class c      
		LEFT JOIN pg_namespace n ON n.oid = c.relnamespace
		LEFT JOIN pg_tablespace t ON t.oid = c.reltablespace
	WHERE c.relkind = ANY (ARRAY['r'::char, 'p'::char]) 
)
WHERE tableowner = 'postgres'
ORDER BY tablename;
```

### Планирование

